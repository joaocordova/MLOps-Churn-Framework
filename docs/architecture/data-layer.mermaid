---
title: "SkyFit Analytics â€” Arquitetura de Dados v2.0"
---

graph TB
    subgraph FONTE["ğŸ—„ï¸ CAMADA RAW (core.*)"]
        EVO_M["evo_members<br/>cadastro + gympass_id"]
        EVO_MM["evo_member_memberships<br/>contratos (cada renovaÃ§Ã£o = linha)"]
        EVO_E["evo_entries<br/>check-ins + block_reason"]
        EVO_S["evo_sales + sale_items<br/>vendas"]
        LTV_R["mv_receivables_normalized<br/>recebÃ­veis (receita real)"]
    end

    subgraph SILVER["âš™ï¸ CAMADA SILVER (analytics.*)"]
        MV1["mv_contract_classified<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Cada contrato com SEGMENTO<br/>â€¢ NÃ­vel 1: nome do plano<br/>â€¢ NÃ­vel 2: entries no perÃ­odo<br/>â€¢ data_efetiva_fim calculada"]

        MV2["mv_spells_v2<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Spell = perÃ­odo contÃ­nuo<br/>â€¢ Segregado por segmento<br/>â€¢ Gap > 30d = novo spell<br/>â€¢ Troca segmento = novo spell"]

        MV3["mv_churn_events<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ CHURN: 30d sem contrato<br/>â€¢ MIGRAÃ‡ÃƒO: troca segmento â‰¤30d<br/>â€¢ ATIVO / INDETERMINADO<br/>â€¢ churn_confirmed_date"]
    end

    subgraph GOLD["ğŸ† CAMADA GOLD (analytics.*)"]
        MV4["mv_member_kpi_base<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ 1 linha por membro<br/>â€¢ Spells + Churn + Freq + Receita<br/>â€¢ Feature Store para ML<br/>â€¢ Insumo para dashboard"]
    end

    subgraph CONSUMO["ğŸ“Š CONSUMO"]
        AF["Azure Functions<br/>(endpoints REST)"]
        DASH["Dashboard Lovable<br/>(KPI cards, heatmap)"]
        ML["Modelo de Churn<br/>(Python/scikit-learn)"]
        EMAIL["RÃ©gua de E-mail<br/>(alertas automÃ¡ticos)"]
    end

    EVO_M --> MV1
    EVO_MM --> MV1
    EVO_E --> MV1

    MV1 --> MV2
    MV2 --> MV3

    MV2 --> MV4
    MV3 --> MV4
    EVO_E --> MV4
    LTV_R --> MV4

    MV4 --> AF
    MV3 --> AF
    AF --> DASH
    MV4 --> ML
    MV4 --> EMAIL

    classDef fonte fill:#2d3748,stroke:#4a5568,color:#e2e8f0
    classDef silver fill:#2c5282,stroke:#3182ce,color:#e2e8f0
    classDef gold fill:#975a16,stroke:#d69e2e,color:#e2e8f0
    classDef consumo fill:#276749,stroke:#38a169,color:#e2e8f0

    class EVO_M,EVO_MM,EVO_E,EVO_S,LTV_R fonte
    class MV1,MV2,MV3 silver
    class MV4 gold
    class AF,DASH,ML,EMAIL consumo
